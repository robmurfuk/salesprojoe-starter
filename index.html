<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SalesProJoe — Assistant</title>
  <style>
    :root { --bg:#0b0c10; --card:#111217; --ink:#e6e6e6; --muted:#a1a1aa; --acc:#4f46e5; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:900px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    header img{width:36px;height:36px;border-radius:8px}
    header h1{font-size:20px;margin:0}
    .card{background:var(--card);border:1px solid #1d1e26;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .chat{height:62vh;overflow:auto;padding:16px;display:flex;flex-direction:column;gap:12px;scroll-behavior:smooth}
    .msg{max-width:78%;padding:12px 14px;border-radius:14px;white-space:pre-wrap}
    .me{align-self:flex-end;background:#1b1c25}
    .bot{align-self:flex-start;background:#161821;border:1px solid #232533}
    .meta{font-size:12px;color:var(--muted)}
    form{display:flex;gap:10px;padding:12px;border-top:1px solid #1d1e26}
    input[type="text"]{flex:1;background:#0e0f15;border:1px solid #1d1e26;border-radius:12px;padding:12px;color:var(--ink)}
    button{background:var(--acc);color:white;border:none;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:12px 16px}
    .brand{display:flex;gap:10px;align-items:center}
    .brand small{color:var(--muted)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="row card">
      <div class="brand">
        <img src="https://dummyimage.com/72x72/4f46e5/ffffff.png&text=SJ" alt="Logo" />
        <div>
          <div style="font-weight:700">SalesProJoe Assistant</div>
          <small>Powered by your backend (no OpenAI branding)</small>
        </div>
      </div>
      <div class="meta">beta</div>
    </div>

    <div class="card" style="margin-top:12px;display:flex;flex-direction:column">
      <div id="chat" class="chat"></div>
      <form id="form">
        <input id="input" type="text" placeholder="Ask me anything…" autocomplete="off" />
        <button id="send" type="submit">Send</button>
      </form>
    </div>
  </div>

  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('form');
    const input = document.getElementById('input');

    const add = (role, text) => {
      const el = document.createElement('div');
      el.className = `msg ${role === 'user' ? 'me' : 'bot'}`;
      el.innerText = text;
      chat.appendChild(el);
      chat.scrollTop = chat.scrollHeight;
    };

    const systemPrompt = "You are SalesProJoe, a crisp, helpful sales training assistant for UK automotive retail. Keep answers concise and accurate.";
    const history = [ { role: 'system', content: systemPrompt } ];

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      input.value = '';
      add('user', text);

      const body = { messages: [ ...history, { role: 'user', content: text } ] };
      document.getElementById('send').disabled = true;
      try {
        const res = await fetch('/api/chat', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
        const data = await res.json();
        if (data?.text) {
          add('assistant', data.text);
          history.push({ role: 'user', content: text }, { role: 'assistant', content: data.text });
          speak(data.text);
        } else {
          add('assistant', 'Sorry—no response.');
        }
      } catch (err) {
        add('assistant', 'Error: ' + (err.message || 'request failed'));
      } finally {
        document.getElementById('send').disabled = false;
      }
    });

    function speak(text){
      try {
        const u = new SpeechSynthesisUtterance(text);
        u.rate = 1.0; u.pitch = 1.0; u.lang = 'en-GB';
        window.speechSynthesis.cancel();
        window.speechSynthesis.speak(u);
      } catch(_) {}
    }
  </script>
</body>
</html>
